programa ejer1
procesos
  proceso incrementar( ES x : numero )
  comenzar
    x := ( x + 1 )
  fin
  
  proceso girar( ES direccionActual : numero ; E giros : numero )
  comenzar
    repetir( giros )
      derecha
      si( direccionActual < 3 )
        incrementar( direccionActual )
      sino
        direccionActual := 0
  fin
  
  proceso reiniciarDireccion( ES direccionActual : numero )
  comenzar
    si( direccionActual <> 0 )
      girar( direccionActual , (4 - direccionActual) )
  fin
  
  proceso cambiarDireccion( ES direccionActual : numero ; E nuevaDireccion : numero )
  comenzar
    mientras( direccionActual <> nuevaDireccion )
      girar( direccionActual , 1 )
  fin
  
  proceso tomarFlores( ES cantFlores : numero )
  comenzar
    mientras( HayFlorEnLaEsquina )
      tomarFlor
      incrementar( cantFlores )
  fin
  
  proceso tomarPapeles( ES cantPapeles : numero )
  comenzar
    mientras( HayPapelEnLaEsquina )
      tomarPapel
      incrementar( cantPapeles )
  fin
  
  proceso limpiarEsquina( ES cantFlores : numero ; ES cantPapeles : numero )
  comenzar
    tomarFlores  ( cantFlores  )
    tomarPapeles ( cantPapeles )
  fin
  
  proceso floresLinea( E largo : numero ; ES cantFlores : numero ; E direccionActual : numero )
  variables
    AvAnterior : numero
    CaAnterior : numero
  comenzar
    si( direccionActual = 0 )
      repetir( largo )
        tomarFlores( cantFlores )
        AvAnterior := PosAv
        CaAnterior := PosCa
        BloquearEsquina( PosAv , (PosCa + 1) )
        mover
        LiberarEsquina( AvAnterior , CaAnterior )
    sino
      si( direccionActual = 1 )
        repetir( largo )
          tomarFlores( cantFlores )
          AvAnterior := PosAv
          CaAnterior := PosCa
          BloquearEsquina( (PosAv + 1) , PosCa )
          mover
          LiberarEsquina( AvAnterior , CaAnterior )
      sino
        si( direccionActual = 2 )
          repetir( largo )
            tomarFlores( cantFlores )
            AvAnterior := PosAv
            CaAnterior := PosCa
            BloquearEsquina( PosAv , (PosCa - 1) )
            mover
            LiberarEsquina( AvAnterior , CaAnterior )
        sino
          repetir( largo )
            tomarFlores( cantFlores )
            AvAnterior := PosAv
            CaAnterior := PosCa
            BloquearEsquina( (PosAv - 1) , PosCa )
            mover
            LiberarEsquina( AvAnterior , CaAnterior )
  fin

  proceso papelesLinea( E largo : numero ; ES cantPapeles : numero ; E direccionActual : numero )
  variables
    AvAnterior : numero
    CaAnterior : numero
  comenzar
    si( direccionActual = 0 )
      repetir( largo )
        tomarPapeles( cantPapeles )
        AvAnterior := PosAv
        CaAnterior := PosCa
        BloquearEsquina( PosAv , (PosCa + 1) )
        mover
        LiberarEsquina( AvAnterior , CaAnterior )
    sino
      si( direccionActual = 1 )
        repetir( largo )
          tomarPapeles( cantPapeles )
          AvAnterior := PosAv
          CaAnterior := PosCa
          BloquearEsquina( (PosAv + 1) , PosCa )
          mover
          LiberarEsquina( AvAnterior , CaAnterior )
      sino
        si( direccionActual = 2 )
          repetir( largo )
            tomarPapeles( cantPapeles )
            AvAnterior := PosAv
            CaAnterior := PosCa
            BloquearEsquina( PosAv , (PosCa - 1) )
            mover
            LiberarEsquina( AvAnterior , CaAnterior )
        sino
          repetir( largo )
            tomarPapeles( cantPapeles )
            AvAnterior := PosAv
            CaAnterior := PosCa
            BloquearEsquina( (PosAv - 1) , PosCa )
            mover
            LiberarEsquina( AvAnterior , CaAnterior )
  fin

  proceso limpiarLinea( E largo : numero ; ES cantFlores : numero ; ES cantPapeles : numero ; E direccionActual : numero )
  variables
    AvAnterior : numero
    CaAnterior : numero
  comenzar
    si( direccionActual = 0 )
      repetir( largo )
        limpiarEsquina( cantFlores , cantPapeles )
        AvAnterior := PosAv
        CaAnterior := PosCa
        BloquearEsquina( PosAv , (PosCa + 1) )
        mover
        LiberarEsquina( AvAnterior , CaAnterior )
    sino
      si( direccionActual = 1 )
        repetir( largo )
          limpiarEsquina( cantFlores , cantPapeles )
          AvAnterior := PosAv
          CaAnterior := PosCa
          BloquearEsquina( (PosAv + 1) , PosCa )
          mover
          LiberarEsquina( AvAnterior , CaAnterior )
      sino
        si( direccionActual = 2 )
          repetir( largo )
            limpiarEsquina( cantFlores , cantPapeles )
            AvAnterior := PosAv
            CaAnterior := PosCa
            BloquearEsquina( PosAv , (PosCa - 1) )
            mover
            LiberarEsquina( AvAnterior , CaAnterior )
        sino
          repetir( largo )
            limpiarEsquina( cantFlores , cantPapeles )
            AvAnterior := PosAv
            CaAnterior := PosCa
            BloquearEsquina( (PosAv - 1) , PosCa )
            mover
            LiberarEsquina( AvAnterior , CaAnterior )
  fin

areas
  ciudad : AreaC( 1 , 1 , 100 , 100 )

robots
  robot florero
  variables
    direccionActual : numero
    cantFlores      : numero
    AvInicial       : numero
  comenzar
    AvInicial       := PosAv
    direccionActual := 0
    cantFlores      := 0

    BloquearEsquina( PosAv , PosCa )

    floresLinea( (100 - PosCa) , cantFlores , direccionActual )
    girar( direccionActual , 1)
    
    floresLinea( (100 - PosAv) , cantFlores , direccionActual )
    girar( direccionActual , 1)
    
    repetir( 3 )
      floresLinea( 99 , cantFlores , direccionActual )
      girar( direccionActual , 1 )
    
    floresLinea( (AvInicial - 1) , cantFlores , direccionActual )
    girar( direccionActual , 1 )
    
    floresLinea( 1 , cantFlores , direccionActual )
  fin

  robot papelero
  variables
    direccionActual : numero
    cantPapeles     : numero
    AvInicial       : numero
  comenzar
    AvInicial       := PosAv
    direccionActual := 0
    cantPapeles     := 0

    BloquearEsquina( PosAv , PosCa )
    
    papelesLinea( (100 - PosCa) , cantPapeles , direccionActual )
    girar( direccionActual , 1 )
    
    
    papelesLinea( (100 - PosAv) , cantPapeles , direccionActual )
    girar( direccionActual , 1 )
    
    repetir( 3 )
      papelesLinea( 99 , cantPapeles , direccionActual )
      girar( direccionActual , 1 )
    
    papelesLinea( (AvInicial - 1) , cantPapeles , direccionActual )
    girar(  direccionActual , 1 )
    
    papelesLinea( 1 , cantPapeles , direccionActual )
  fin 

variables
  robot1 : florero
  robot2 : papelero

comenzar
  AsignarArea( robot1 , ciudad )
  AsignarArea( robot2 , ciudad )
  Iniciar( robot1 , 49 , 50 )
  Iniciar( robot2 , 50 , 49 )
fin